var vpsc;(function(n){var u=function(){function n(n){this.scale=n,this.AB=0,this.AD=0,this.A2=0}return n.prototype.addVariable=function(n){var t=this.scale/n.scale,r=n.offset/n.scale,i=n.weight;this.AB+=i*t*r,this.AD+=i*t*n.desiredPosition,this.A2+=i*t*t},n.prototype.getPosn=function(){return(this.AD-this.AB)/this.A2},n}(),f,e,t,i,r;n.PositionStats=u,f=function(){function n(n,t,i,r){typeof r=="undefined"&&(r=!1),this.left=n,this.right=t,this.gap=i,this.equality=r,this.active=!1,this.unsatisfiable=!1}return n.prototype.slack=function(){return this.unsatisfiable?Number.MAX_VALUE:this.right.scale*this.right.position()-this.gap-this.left.scale*this.left.position()},n}(),n.Constraint=f,e=function(){function n(n,t,i){typeof t=="undefined"&&(t=1),typeof i=="undefined"&&(i=1),this.desiredPosition=n,this.weight=t,this.scale=i,this.offset=0}return n.prototype.dfdv=function(){return 2*this.weight*(this.position()-this.desiredPosition)},n.prototype.position=function(){return(this.block.ps.scale*this.block.posn+this.offset)/this.scale},n.prototype.visitNeighbours=function(n,t){var i=function(i,r){i.active&&n!==r&&t(i,r)};this.cOut.forEach(function(n){return i(n,n.right)}),this.cIn.forEach(function(n){return i(n,n.left)})},n}(),n.Variable=e,t=function(){function n(n){n.offset=0,this.vars=[],this.ps=new u(n.scale),this.addVariable(n)}return n.prototype.addVariable=function(n){n.block=this,this.vars.push(n),this.ps.addVariable(n),this.posn=this.ps.getPosn()},n.prototype.updateWeightedPosition=function(){this.ps.AB=this.ps.AD=this.ps.A2=0;for(var n=0,t=this.vars.length;n<t;++n)this.ps.addVariable(this.vars[n]);this.posn=this.ps.getPosn()},n.prototype.compute_lm=function(n,t,i){var u=this,r=n.dfdv();return n.visitNeighbours(t,function(t,f){var e=u.compute_lm(f,n,i);f===t.right?(r+=e*t.left.scale,t.lm=e):(r+=e*t.right.scale,t.lm=-e),i(t)}),r/n.scale},n.prototype.populateSplitBlock=function(n,t){var i=this;n.visitNeighbours(t,function(t,r){r.offset=n.offset+(r===t.right?t.gap:-t.gap),i.addVariable(r),i.populateSplitBlock(r,n)})},n.prototype.traverse=function(n,t,i,r){typeof i=="undefined"&&(i=this.vars[0]),typeof r=="undefined"&&(r=null);var u=this;i.visitNeighbours(r,function(r,f){t.push(n(r)),u.traverse(n,t,f,i)})},n.prototype.findMinLM=function(){var n=null;return this.compute_lm(this.vars[0],null,function(t){!t.equality&&(n===null||t.lm<n.lm)&&(n=t)}),n},n.prototype.findMinLMBetween=function(n,t){this.compute_lm(n,null,function(){});var i=null;return this.findPath(n,null,t,function(n,t){!n.equality&&n.right===t&&(i===null||n.lm<i.lm)&&(i=n)}),i},n.prototype.findPath=function(n,t,i,r){var f=this,u=!1;return n.visitNeighbours(t,function(t,e){!u&&(e===i||f.findPath(e,n,i,r))&&(u=!0,r(t,e))}),u},n.prototype.isActiveDirectedPathBetween=function(n,t){var i,r;if(n===t)return!0;for(i=n.cOut.length;i--;)if(r=n.cOut[i],r.active&&this.isActiveDirectedPathBetween(r.right,t))return!0;return!1},n.split=function(t){return t.active=!1,[n.createSplitBlock(t.left),n.createSplitBlock(t.right)]},n.createSplitBlock=function(t){var i=new n(t);return i.populateSplitBlock(t,null),i},n.prototype.splitBetween=function(t,i){var r=this.findMinLMBetween(t,i),u;return r!==null&&(u=n.split(r)),{constraint:r,lb:u[0],rb:u[1]}},n.prototype.mergeAcross=function(n,t,i){var r,f,u;for(t.active=!0,r=0,f=n.vars.length;r<f;++r)u=n.vars[r],u.offset+=i,this.addVariable(u);this.posn=this.ps.getPosn()},n.prototype.cost=function(){for(var i=0,r=this.vars.length,n,t;r--;)n=this.vars[r],t=n.position()-n.desiredPosition,i+=t*t*n.weight;return i},n}(),n.Block=t,i=function(){function n(n){var i,r;for(this.vs=n,i=n.length,this.list=new Array(i);i--;)r=new t(n[i]),this.list[i]=r,r.blockInd=i}return n.prototype.cost=function(){for(var n=0,t=this.list.length;t--;)n+=this.list[t].cost();return n},n.prototype.insert=function(n){n.blockInd=this.list.length,this.list.push(n)},n.prototype.remove=function(n){var i=this.list.length-1,t=this.list[i];this.list.length=i,n!==t&&(this.list[n.blockInd]=t,t.blockInd=n.blockInd)},n.prototype.merge=function(n){var t=n.left.block,i=n.right.block,r=n.right.offset-n.left.offset-n.gap;t.vars.length<i.vars.length?(i.mergeAcross(t,n,r),this.remove(t)):(t.mergeAcross(i,n,-r),this.remove(i))},n.prototype.forEach=function(n){this.list.forEach(n)},n.prototype.updateBlockPositions=function(){this.list.forEach(function(n){return n.updateWeightedPosition()})},n.prototype.split=function(n){var i=this;this.updateBlockPositions(),this.list.forEach(function(u){var f=u.findMinLM();f!==null&&f.lm<r.LAGRANGIAN_TOLERANCE&&(u=f.left.block,t.split(f).forEach(function(n){return i.insert(n)}),i.remove(u),n.push(f))})},n}(),n.Blocks=i,r=function(){function n(n,t){this.vs=n,n.forEach(function(n){n.cIn=[],n.cOut=[]}),this.cs=t,t.forEach(function(n){n.left.cOut.push(n),n.right.cIn.push(n)}),this.inactive=t.map(function(n){return n.active=!1,n}),this.bs=new i(n)}return n.prototype.cost=function(){return this.bs.cost()},n.prototype.mostViolated=function(){for(var e=Number.MAX_VALUE,f=null,t=this.inactive,i=t.length,o=i,u,s,r=0;r<i;++r)if(u=t[r],s=u.slack(),(u.equality||s<e)&&(e=s,f=u,o=r,u.equality))break;return o!==i&&(e<n.ZERO_UPPERBOUND&&!f.active||f.equality)&&(t[o]=t[i-1],t.length=i-1),f},n.prototype.satisfy=function(){var t,i,u,r;for(this.bs.split(this.inactive),t=null;(t=this.mostViolated())&&(t.equality||t.slack()<n.ZERO_UPPERBOUND&&!t.active);)if(i=t.left.block,u=t.right.block,i!==u)this.bs.merge(t);else{if(i.isActiveDirectedPathBetween(t.right,t.left)){t.unsatisfiable=!0;continue}if(r=i.splitBetween(t.left,t.right),this.bs.insert(r.lb),this.bs.insert(r.rb),this.bs.remove(i),r.constraint!==null)this.inactive.push(r.constraint);else{t.unsatisfiable=!0;continue}t.slack()>=0?this.inactive.push(t):this.bs.merge(t)}},n.prototype.solve=function(){this.satisfy();for(var t=Number.MAX_VALUE,n=this.bs.cost();Math.abs(t-n)>.0001;)this.satisfy(),t=n,n=this.bs.cost();return n},n.LAGRANGIAN_TOLERANCE=-.0001,n.ZERO_UPPERBOUND=-1e-10,n}(),n.Solver=r})(vpsc||(vpsc={}))