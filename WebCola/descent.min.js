var Descent=function(){function n(n,t,i){var r,u;for(this.D=i,this.x=n,this.y=t,r=this.n=n.length,this.Hx=new Array(r),this.Hy=new Array(r),u=0;u<r;++u)this.Hx[u]=new Array(r),this.Hy[u]=new Array(r);this.gx=new Array(r),this.gy=new Array(r),this.Hdx=new Array(r),this.Hdy=new Array(r),this.x0=new Array(2*r),this.a=new Array(2*r),this.b=new Array(2*r),this.c=new Array(2*r),this.d=new Array(2*r),this.ia=new Array(2*r),this.ib=new Array(2*r),this.xtmp=new Array(r),this.ytmp=new Array(r)}return n.prototype.computeDerivatives=function(n,t){var s=this.n,i,h,c,r,u,f,a;if(!(s<=1))for(i=0;i<s;++i){for(h=this.gx[i]=0,c=this.gy[i]=0,r=0;r<s;++r)if(i!==r){for(;;)if(u=n[i]-n[r],f=t[i]-t[r],u===0&&f===0)n[r]+=Math.random(),t[r]+=Math.random();else break;var v=u*u,y=f*f,e=Math.sqrt(v+y),o=this.D[i][r],l=o*o,p=(e-o)/(l*e);this.gx[i]+=u*p,this.gy[i]+=f*p,a=o/(e*e*e),h-=this.Hx[i][r]=(a*y-1)/l,c-=this.Hy[i][r]=(a*v-1)/l}this.Hx[i][i]=h,this.Hy[i][i]=c}},n.dotProd=function(n,t){for(var r=0,i=0,u=n.length;i<u;++i)r+=n[i]*t[i];return r},n.rightMultiply=function(t,i,r){for(var u=0,f=t.length;u<f;++u)r[u]=n.dotProd(t[u],i)},n.prototype.computeStepSize=function(t,i){var u=n.dotProd(this.gx,t)+n.dotProd(this.gy,i),r;return(n.rightMultiply(this.Hx,t,this.Hdx),n.rightMultiply(this.Hy,i,this.Hdy),r=n.dotProd(t,this.Hdx)+n.dotProd(i,this.Hdy),r===0)?0:u/r},n.prototype.reduceStress=function(){this.computeDerivatives(this.x,this.y);var n=this.computeStepSize(this.gx,this.gy);return this.takeDescentStep(this.x,this.gx,n),this.takeDescentStep(this.y,this.gy,n),this.computeStress()},n.split=function(n,t,i){for(var r=0,u=t.length;r<u;++r)t[r]=n[r],i[r]=n[r+u]},n.unsplit=function(n,t,i){for(var r=0,u=n.length;r<u;++r)i[r]=n[r],i[r+u]=t[r]},n.prototype.computeNextPosition=function(t,i){n.split(t,this.xtmp,this.ytmp),this.computeDerivatives(this.xtmp,this.ytmp);var r=this.computeStepSize(this.gx,this.gy);this.takeDescentStep(this.xtmp,this.gx,r),this.xproject&&this.xproject(this.xtmp),this.takeDescentStep(this.ytmp,this.gy,r),this.yproject&&this.yproject(this.ytmp),n.unsplit(this.xtmp,this.ytmp,i)},n.prototype.rungeKutta=function(){var t,i;for(n.unsplit(this.x,this.y,this.x0),this.computeNextPosition(this.x0,this.a),n.mid(this.x0,this.a,this.ia),this.computeNextPosition(this.ia,this.b),n.mid(this.x0,this.b,this.ib),this.computeNextPosition(this.ib,this.c),this.computeNextPosition(this.c,this.d),t=0;t<this.n;++t)this.x[t]=(this.a[t]+2*this.b[t]+2*this.c[t]+this.d[t])/6,i=t+this.n,this.y[t]=(this.a[i]+2*this.b[i]+2*this.c[i]+this.d[i])/6;return this.computeStress()},n.mid=function(n,t,i){for(var u=n.length,r=0;r<u;++r)i[r]=n[r]+(t[r]-n[r])/2},n.prototype.takeDescentStep=function(n,t,i){for(var r=0;r<this.n;++r)n[r]=n[r]-i*t[r]},n.prototype.computeStress=function(){for(var r=0,t,f,n=0,u=this.n-1;n<u;++n)for(t=n+1,f=this.n;t<f;++t){var e=this.x[n]-this.x[t],o=this.y[n]-this.y[t],h=Math.sqrt(e*e+o*o),i=this.D[n][t],c=i*i,s=i-h;r+=s*s/c}return r},n.zeroDistance=1e-10,n}()